# 本研究需要搞清楚的问题
1. 不止从统计意义来对股票进行预测，而是从更偏向金融的角度用基本面、市场情绪、市场资金流向和政策变化等角度对股票进行趋势上的预测
2. 对政策变换等非结构性数据进行量化和结构化处理，使其能够变成一个可以描述的序列数据，进行数据分析并让模型端到端的处理
3. 使用机器学习手段预处理数据+ANNs进行数据的回归，使用混合模型（如LSTM+transformers）进行时域和频域上的分析，整个数据流向应该是：非结构数据->结构数据+股票历史数据小波变换尺度拆分，取低频（因为并不需要量化进行所需的在很小的时间尺度内进行高频交易）->以行为数据种类列为时间顺序的矩阵，不知道现有的研究有没有这样做的，我也没想好这个矩阵叫做什么->混合模型从数据种类和数据时间截面（截面窗口大小大约在5-10天左右）进行分析并输出独热编码（更好的想法是to text）
4. 定义好状态空间，将状态空间分割成训练和测试集，损失函数定义为预测趋势和实际趋势的平方差，价值函数定义为模型在某个完整的状态空间求损失函数的均方误差，对这个价值函数进行梯度下降求解最佳模型


chatGPT帮忙整理的版本如下：
# 股票趋势预测的研究思路与发展路径

## 1. 核心问题与数学本质
- **核心问题**：用多模态信息（数值时序 + 文本事件 + 群体情绪 + 资金流）预测若干交易日后的股票趋势（或回报）。  
  数学本质是一个 **带外生事件的多变量时序预测问题**。  
- **公式化**：  
  预测未来收益序列的条件分布：
  $$
  P(r_{t+h}\mid \mathcal{H}_t)
  $$
  其中 $\mathcal{H}_t$ 含有结构化与非结构化数据。

- **难点**：
  1. 非结构化政策文本如何被量化为时间序列；
  2. 信号稀疏、噪声大，容易过拟合；
  3. 市场存在 **结构性变点（regime shift）**；
  4. 不同模态的频率与延迟不一致。

---

## 2. 变量识别
- **价格/技术类**：OHLC、对数收益、波动率、成交量等。  
- **基本面**：EPS、营收同比、估值指标等。  
- **市场情绪**：新闻/微博情感得分、搜索热度、舆情强度、VIX。  
- **资金流向**：ETF/公募净流入、融资融券余额等。  
- **政策/公告事件（非结构）**：文本结构化后的事件特征。  
- **横截面关系**：行业/概念标签、相关性、供应链关系。  

---

## 3. 非结构化文本到序列的管道
1. **抓取 + 清洗** → 公告/新闻 → 文本预处理。  
2. **事件抽取** → 得到字段 `{event_type, target_sector, magnitude, tone...}`。  
3. **文本向量化** → BERT embedding + “语义惊奇度”。  
4. **事件强度量化** → 强度 $s$ + 指数衰减：
   $$
   I_t=\sum_{\tau\le t} s_\tau e^{-\frac{t-\tau}{\lambda}}
   $$
5. **行业/个股贴标**。  
6. **置信度建模** → 用于加权训练。  

---

## 4. 数据结构化与命名
- **单只股票单窗口**：  
  $$
  \mathbf{X}_{s,t}\in\mathbb{R}^{F\times W}
  $$
  - $F$ = 特征种类数，$W$ = 窗口天数（5–10）。  
- **多只股票批次**：  
  $$
  \mathcal{X}\in\mathbb{R}^{B\times N\times F\times W}
  $$
- **命名建议**：
  - **多模态时间-截面张量 (MTT)**  
  - **事件增强时序矩阵 (EATM)**  

---

## 5. 预处理与降噪
- **小波分解**：  
  $$
  p_t = A_{J,t} + \sum_{j=1}^J D_{j,t}
  $$
  只保留低频 $A_{J,t}$ 作为趋势输入。  
- **归一化/去趋势**：滚动Z-score、对数收益、Winsorize。  
- **缺失处理**：时间对齐 + 缺失mask。  

---

## 6. 模型架构
### 基线
- ARX、随机森林、XGBoost。  

### 混合模型
1. **输入分支**  
   - A：低频趋势 → LSTM/GRU  
   - B：事件序列 → Transformer encoder  
   - C：情绪/资金流 → 轻量LSTM  
   - D：横截面 → GNN  

2. **融合层**：多头注意力 (Transformer cross-modal)。  
3. **输出层**：  
   - 回归：未来 $h$ 日收益  
   - 分类：趋势（涨/平/跌）  
   - 可选：to text（解释型输出）  

---

## 7. 目标函数与评价
- **回归目标**：  
  $$
  \mathcal{L} = \alpha \text{MSE} + \beta \text{DownsideLoss} + \gamma \text{TurnoverPenalty}
  $$
- **分类目标**：交叉熵 + 类别权重。  
- **经济目标**：模拟PnL，优化夏普比、最大回撤。  

---

## 8. 验证与回测
- 时间序列交叉验证（walk-forward）。  
- 回测考虑：交易成本、滑点、成交量限制。  
- 防止未来信息泄露。  
- 压力测试（牛市/熊市/高波动）。  

---

## 9. 实验设计（Ablation）
1. 只用价格 → 基线。  
2. + 基本面。  
3. + 资金流、情绪。  
4. + 结构化事件。  
5. 小波 vs 无小波。  
6. LSTM vs Transformer vs 混合。  
7. 加入 GNN。  
8. 不同窗口大小。  

---

## 10. 创新点与得分潜力
- **创新点**：
  - 政策/公告 → 事件 → 时间衰减 → 序列化。  
  - 多模态 attention 融合。  
  - 融合 GNN 捕捉行业冲击。  

- **得分潜力**：高。  
  - 数学建模：事件衰减模型、小波分解、状态空间。  
  - 算法创新：混合网络、事件量化。  
  - 实验严谨：消融、回测。  

---

## 11. 难点与缓解
- 事件效果稀疏 → 衰减+置信度。  
- NLP误差大 → 小规模人工标注。  
- 市场 regime shift → 分段训练、CUSUM检测。  
- 过拟合 → 先小模型验证，再上大模型。  

---

## 12. 实施路线
- **A：定义问题与数据清单**  
- **B：数据采集与清洗**  
- **C：特征工程与基线建模**  
- **D：事件结构化与衰减模型**  
- **E：混合模型实现与训练**  
- **F：回测与风险评估**  
- **G：可解释性与报告打磨**  

---

## 13. 工具生态
- **NLP**：HuggingFace、spaCy、BERT。  
- **时序**：PyTorch、PyTorch Lightning。  
- **小波**：PyWavelets。  
- **GNN**：PyTorch Geometric、DGL。  
- **回测**：Backtrader、zipline。  
- **可解释性**：SHAP、Captum。  

---

## 14. 数学化要点
- **事件衰减**：
  $$
  I_{s,t}=\sum_{\tau\le t}\, S_{s,\tau}\cdot e^{-\frac{t-\tau}{\lambda}}\cdot c_{s,\tau}
  $$
- **小波分解**：
  $$
  p_t = A_{J,t} + \sum_{j=1}^J D_{j,t}
  $$
- **状态空间**：
  $$
  \begin{cases}
  \mathbf{z}_{t+1}=F\mathbf{z}_t + G\mathbf{u}_t + \eta_t \\
  y_t = H\mathbf{z}_t + \varepsilon_t
  \end{cases}
  $$

---

## 15. 实务提醒
- 政策文本“变成可训练序列”是最大亮点，也是最大挑战。  
- 要写清楚数学化的事件量化 + 模型衰减机制，比单纯堆网络更有说服力。  



关于数据预处理可以参考[[A New Hybrid Forecasting Model Based on SW-LSTM and Wavelet Packet Decomposition—— A Case Study of Oil Futures Prices]]
的解法先进行WDP小波变换，这样可以把不同频域的各种特征更好的使用多头注意力进行提取

[Python-利用小波变换预测股票_股票小波分析-CSDN博客](https://blog.csdn.net/qq_41929396/article/details/132971302)
https://www.bilibili.com/video/BV1R4UWYpEw8?t=1.0小波变换

使用波动聚类现象归纳某个时间段之内的股票趋势

## 对于不同的股票要有不同的适应
主要类型：
- 蓝筹股：业绩稳健，分红率高，适合长期持有的
- 成长股：业绩增长快速，风险相对较大，适合追求资本增值的投资者
- 收入股：高股息为主要的收益来源，适合保守型投资者
- 投机股、反周期股：在资产配置中占有一定的位置

好像可以使用信息熵对文本数据进行分析，来辅助判断一个信息的可靠程度或者权重

[[Transformers with Attentive Federated Aggregation for Time Series Stock Forecasting]]